@page "/"
@using MauiBlazorDemoApp.Data
@inject SkolplattformenService SkolplattformenService

<h1>Hello, world!</h1>


@if(SkolplattformenService.IsLoggedIn)
{
    <span>Välkommen @SkolplattformenService.LoggedInName</span>


    <button class="btn btn-primary" @onclick="LogoutButtonPressed">Logga ut</button>
}
else
{
    <p>Logga in</p>
    <div class="form-group mb-3">
        <input class="form-control mb-2" type="text" @bind=@email placeholder="email">
        <input class="form-control mb-2" type="text" @bind=@username placeholder="användarnamn">
        <input class="form-control mb-2" type="password" @bind=@password placeholder="lösenord">

        <button class="btn btn-primary" @onclick="LoginButtonPressed">Logga in</button>
    </div>

    <div class="form-group">
        <select class="form-control" @bind=@System>
            <option value="1">Skolplattformen</option>
            <option value="2">Demo</option>
        </select>
    </div>

}






@code{
    private string email = "";
    private string username = "";
    private string password = "";

    private string system;

    private string System
    {
        get => system;
        set { system = value;
            ChangeApi();
        }
    }

  
    private void ChangeApi()
    {
        ApiKind kind;
        switch (system)
        {
            case "1":
                kind = ApiKind.Skolplattformen;
                break;
            case "2":
                kind = ApiKind.FakeData;
                break;
            default:
                throw new ArgumentOutOfRangeException(nameof(kind));
        }

        SkolplattformenService.SelectApi(kind);
    }

    private async Task LoginButtonPressed()
    {
        await SkolplattformenService.LogInAsync(email, username, password);
        StateHasChanged();
    }

    private void LogoutButtonPressed()
    {
        SkolplattformenService.LogOut();
        StateHasChanged();
    }
}